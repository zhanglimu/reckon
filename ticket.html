<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Graphic line</title>  	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="shortcut icon" type="image/x-icon" href="./img/biticon.ico" media="screen" />
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
	<link href="css/elegant-icons.css" rel="stylesheet" type="text/css">
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/ticket.js"></script>
    <link rel="stylesheet" type="text/css" href="css/base.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="http://echarts.baidu.com/build/dist/echarts-all.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
</head>
<body>
	<header id="top">
		<ul class="nim">
			<li>
				<a href="javascript:history.go(-1)">
					<i class="fa fa-chevron-left fa-lg left"></i>
				</a>
			</li>
			<li><h4>价格走势</h4></li>
			<li><i onclick="replaceDoc()" class="fa fa-repeat fa-lg right"></i></li>
		</ul>
	</header> 
    <article ng-controller="ticketctrl as tick">
        <div>
			<h5 class="shou">专家推荐</h5>
			<div class="a">

			</div>

			<!-- <table class="sigerd">
				<tbody>
					<tr class="lists">
						<td>切尔西</td>
						<td>（未）</td>
						<td>国米</td>
					</tr>
					<tr class="she">
						<td class="sheng"><button>胜</button></td>
						<td><button>平</button></td>
						<td><button>负</button></td>
					</tr>
				</tbody>
				<tbody>
					<tr class="lists">
						<td>曼联</td>
						<td>（完）</td>
						<td>恒大</td>
					</tr>
					<tr class="she">
						<td class="sheng"><button>胜</button></td>
						<td><button>平</button></td>
						<td><button>负</button></td>
					</tr>
				</tbody>
			</table> -->
		
			<div class="echarts">
				<div class="echartsdiv" style="width: 100%;border: 1px solid #ddd;">
					<div id="main" style="width: 100%; height:300px;"></div>
					<script type="text/javascript">
					
						function echart(){
							// var XData=["出票", "当前"];
							// var shu=["1","2","3","4","5","5","6","7","8"]
							var chart = function(data) {
							Xtimes=[];    //实际用来盛放X轴坐标值
							shuju=[];
							count=0;
							maxprice=data.maxPrice;
							successdata = data.oddsHistory;
							// successdata = JSON.parse(successdata);
							if (successdata) {
								count =successdata.length;
								successdata[0].timestamp="出票";
								successdata[count-1].timestamp="当前";
								for (var i = 0; i < successdata.length; i++) {
									Xtimes.push(successdata[i].timestamp);
									shuju.push(successdata[i].price);
									console.log(Xtimes)
									
								}
							}
						}
						$.ajax({ 
							async : false,
							type : "GET",
							// url : 'http://private-200ab-zhanglimu.apiary-mock.com/price/getTicketGraph?tkId=' + tkId+ '&agentid=' + agentid,
							url : 'http://private-200ab-zhanglimu.apiary-mock.com/price/getTicketGraph',
							dataType : "json",
							success : function(data) {
								chart(data);
								$(".tbottom").empty();
								// var html='<h4>'+'最高价格：'+'<i>' + data.maxPrice + '</i>'+'</h4>';
								$('.echarts').after('<div class\="tbottom\">'+'<h4>'+'最高价格：'+'<i>' + data.maxPrice + '</i>'+'</h4>'+'</div >');
								// $(".tbottom").append("'<h4>'+'最高价格：'+'<i>' + data.maxPrice + '</i>'+'</h4>'")
							}
						});

						var myChart = echarts.init(document.getElementById('main'));
						var option = {　　　　
							tooltip: {
								show:true,
					        },
							title: {
//								text: '平',
								textStyle: {
						            fontSize: 14,
						            fontWeight: 'bolder',
						        },
							}, 
							grid:{
								borderWidth:0,  //去掉外围线
								x:20,
								y:20,
								x2:20,
								y2:40,
							},
							xAxis: [{
								splitLine: {show: false}, //去除网格线
								axisTick: {show: false}, //去掉刻度
								type: 'category',
								boundaryGap: false,
								data: Xtimes,
								axisLine:{
				                    lineStyle:{
				                        color:'#959595',
				                        width:1,
				                    }
				                },
				                axisLabel: {
									interval:count-2,
									// rotate : 40, 
								},
							}],
							yAxis: [{
								splitLine: {show: false},
								axisTick: {show: false},
								type: 'value',
								axisLabel: {
									show: false,  //刻度值
								},
								axisLine:{
				                    lineStyle:{
				                        color:'#959595',
				                        width:1,
				                    }
				                },
							}],
							series: [{
								type: 'line',
								data: shuju,
						        symbol:'none',  //去掉圆点
								itemStyle: {
						            normal: {
										areaStyle: {type: 'default'},
						              	lineStyle:{  
					                      	color:'#fe3c3c',
											width:1.5
					                    },
					                }
								},
								
							}]
						};
						myChart.setOption(option, true);
						}
						echart();
						
					</script>
				</div>
				<h5>以上数据由<i>彩易科思</i>提供</h5>
			</div>
			<!-- <div class="tbottom">
				<h4>最高价格：<i>maxPrice-82</i></h4>
			</div> -->
		</div>
		</div>
		<script>  
			var tkId = UrlParam.paramValues("tkId");  
			var agentid = UrlParam.paramValues("agentid");  
			console.log(tkId,agentid);  

						var json=[
							{
								"homeName":"贝内文托",
								"awayName":"热那亚",
								"play":"1",
								"achievement":"0",
								"matchState":"完",
							},
							{
								"homeName":"拉古纳",
								"awayName":"托卢卡",
								"play":"2",
								"achievement":"1",
								"matchState":"未",
							}
						];
			window.demo = function(dataObj, callback){
				console.log(dataObj,"1");
				if(callback && callback instanceof Function){
					//callback();
					var html="";
					$('.a').empty();
					for (var i = 0; i < dataObj.length; i++) {
						html +='<table class\="sigerd\">'+'<tbody>'+'<tr class="lists">';
						html +='<td>'+dataObj[i].homeName+'</td>';
						html +='<td>'+'VS'+'</td>';
						html +='<td>'+dataObj[i].awayName+'</td>'+'</tr>';

						dataObj[i].play==0?	html +='<tr class\="she\">'+'<td>'+'<button style="background:#fe3c3c;color:#fff;">'+'胜'+'</button>'+'</td>'
						:	html +='<tr class\="she\">'+'<td>'+'<button>'+'胜'+'</button>'+'</td>';
						dataObj[i].play==1?	html +='<td>'+'<button style="background:#fe3c3c;color:#fff;">'+'平'+'</button>'+'</td>'
						:	html +='<td>'+'<button>'+'平'+'</button>'+'</td>';
						dataObj[i].play ==2?html +='<td>'+'<button style="background:#fe3c3c;color:#fff;">'+'负'+'</button>'+'</td>'+'</tr>'
						:html +='<td>'+'<button>'+'负'+'</button>'+'</td>'+'</tr>';
						// dataObj[i].achievement ==0?html+='赢':html+='负';
						html +='</tbody>'+'</table>';
						
					}
					$('.a').append(html);
				}
			}
			demo(json,function(){})
			setInterval(function(){
				echart();
				demo(json,function(){})
			},30000);
			function replaceDoc(){
				window.location.reload()
			}
		</script>
		
    </article>
</body>
</html>